/**
 * Pentest Types
 *
 * Type definitions for penetration testing in the security platform
 */

// ============================================
// Campaign Types
// ============================================

export type CampaignStatus = "planning" | "in_progress" | "completed" | "on_hold" | "cancelled";

export type CampaignType =
  | "external"
  | "internal"
  | "web_app"
  | "mobile"
  | "api"
  | "network"
  | "social_engineering"
  | "physical"
  | "cloud"
  | "wireless";

export type CampaignPriority = "critical" | "high" | "medium" | "low";

export const CAMPAIGN_STATUS_LABELS: Record<CampaignStatus, string> = {
  planning: "Planning",
  in_progress: "In Progress",
  completed: "Completed",
  on_hold: "On Hold",
  cancelled: "Cancelled",
};

export const CAMPAIGN_STATUS_COLORS: Record<CampaignStatus, { bg: string; text: string }> = {
  planning: { bg: "bg-blue-100 dark:bg-blue-900/30", text: "text-blue-700 dark:text-blue-400" },
  in_progress: { bg: "bg-yellow-100 dark:bg-yellow-900/30", text: "text-yellow-700 dark:text-yellow-400" },
  completed: { bg: "bg-green-100 dark:bg-green-900/30", text: "text-green-700 dark:text-green-400" },
  on_hold: { bg: "bg-orange-100 dark:bg-orange-900/30", text: "text-orange-700 dark:text-orange-400" },
  cancelled: { bg: "bg-red-100 dark:bg-red-900/30", text: "text-red-700 dark:text-red-400" },
};

export const CAMPAIGN_TYPE_LABELS: Record<CampaignType, string> = {
  external: "External Pentest",
  internal: "Internal Pentest",
  web_app: "Web Application",
  mobile: "Mobile Application",
  api: "API Testing",
  network: "Network Pentest",
  social_engineering: "Social Engineering",
  physical: "Physical Security",
  cloud: "Cloud Infrastructure",
  wireless: "Wireless Network",
};

export const CAMPAIGN_TYPE_ICONS: Record<CampaignType, string> = {
  external: "Globe",
  internal: "Server",
  web_app: "Layout",
  mobile: "Smartphone",
  api: "Code",
  network: "Network",
  social_engineering: "Users",
  physical: "Building",
  cloud: "Cloud",
  wireless: "Wifi",
};

export const CAMPAIGN_PRIORITY_LABELS: Record<CampaignPriority, string> = {
  critical: "Critical",
  high: "High",
  medium: "Medium",
  low: "Low",
};

export const CAMPAIGN_PRIORITY_COLORS: Record<CampaignPriority, { bg: string; text: string }> = {
  critical: { bg: "bg-red-100 dark:bg-red-900/30", text: "text-red-700 dark:text-red-400" },
  high: { bg: "bg-orange-100 dark:bg-orange-900/30", text: "text-orange-700 dark:text-orange-400" },
  medium: { bg: "bg-yellow-100 dark:bg-yellow-900/30", text: "text-yellow-700 dark:text-yellow-400" },
  low: { bg: "bg-green-100 dark:bg-green-900/30", text: "text-green-700 dark:text-green-400" },
};

// ============================================
// Finding Types
// ============================================

export type FindingSeverity = "critical" | "high" | "medium" | "low" | "info";

export type FindingStatus =
  | "draft"
  | "in_review"
  | "confirmed"
  | "remediation"
  | "retest"
  | "verified"
  | "false_positive"
  | "accepted_risk";

export const FINDING_SEVERITY_LABELS: Record<FindingSeverity, string> = {
  critical: "Critical",
  high: "High",
  medium: "Medium",
  low: "Low",
  info: "Informational",
};

export const FINDING_SEVERITY_COLORS: Record<FindingSeverity, { bg: string; text: string }> = {
  critical: { bg: "bg-red-100 dark:bg-red-900/30", text: "text-red-700 dark:text-red-400" },
  high: { bg: "bg-orange-100 dark:bg-orange-900/30", text: "text-orange-700 dark:text-orange-400" },
  medium: { bg: "bg-yellow-100 dark:bg-yellow-900/30", text: "text-yellow-700 dark:text-yellow-400" },
  low: { bg: "bg-blue-100 dark:bg-blue-900/30", text: "text-blue-700 dark:text-blue-400" },
  info: { bg: "bg-gray-100 dark:bg-gray-900/30", text: "text-gray-700 dark:text-gray-400" },
};

export const FINDING_STATUS_LABELS: Record<FindingStatus, string> = {
  draft: "Draft",
  in_review: "In Review",
  confirmed: "Confirmed",
  remediation: "Remediation",
  retest: "Retest",
  verified: "Verified",
  false_positive: "False Positive",
  accepted_risk: "Accepted Risk",
};

export const FINDING_STATUS_COLORS: Record<FindingStatus, { bg: string; text: string }> = {
  draft: { bg: "bg-gray-100 dark:bg-gray-900/30", text: "text-gray-700 dark:text-gray-400" },
  in_review: { bg: "bg-blue-100 dark:bg-blue-900/30", text: "text-blue-700 dark:text-blue-400" },
  confirmed: { bg: "bg-purple-100 dark:bg-purple-900/30", text: "text-purple-700 dark:text-purple-400" },
  remediation: { bg: "bg-yellow-100 dark:bg-yellow-900/30", text: "text-yellow-700 dark:text-yellow-400" },
  retest: { bg: "bg-orange-100 dark:bg-orange-900/30", text: "text-orange-700 dark:text-orange-400" },
  verified: { bg: "bg-green-100 dark:bg-green-900/30", text: "text-green-700 dark:text-green-400" },
  false_positive: { bg: "bg-slate-100 dark:bg-slate-900/30", text: "text-slate-700 dark:text-slate-400" },
  accepted_risk: { bg: "bg-amber-100 dark:bg-amber-900/30", text: "text-amber-700 dark:text-amber-400" },
};

// ============================================
// OWASP Categories
// ============================================

export type OwaspCategory =
  | "A01:2021" // Broken Access Control
  | "A02:2021" // Cryptographic Failures
  | "A03:2021" // Injection
  | "A04:2021" // Insecure Design
  | "A05:2021" // Security Misconfiguration
  | "A06:2021" // Vulnerable Components
  | "A07:2021" // Auth Failures
  | "A08:2021" // Software and Data Integrity
  | "A09:2021" // Logging Failures
  | "A10:2021"; // SSRF

export const OWASP_CATEGORY_LABELS: Record<OwaspCategory, string> = {
  "A01:2021": "Broken Access Control",
  "A02:2021": "Cryptographic Failures",
  "A03:2021": "Injection",
  "A04:2021": "Insecure Design",
  "A05:2021": "Security Misconfiguration",
  "A06:2021": "Vulnerable and Outdated Components",
  "A07:2021": "Identification and Authentication Failures",
  "A08:2021": "Software and Data Integrity Failures",
  "A09:2021": "Security Logging and Monitoring Failures",
  "A10:2021": "Server-Side Request Forgery (SSRF)",
};

// ============================================
// Interfaces
// ============================================

export interface TeamMember {
  id: string;
  name: string;
  email: string;
  role: "lead" | "tester" | "reviewer" | "observer";
  avatar?: string;
}

export interface ScopeItem {
  id: string;
  type: "domain" | "ip" | "cidr" | "url" | "application";
  value: string;
  inScope: boolean;
  notes?: string;
}

export interface RulesOfEngagement {
  testingHours: string;
  allowedMethods: string[];
  restrictedMethods: string[];
  emergencyContact: string;
  communicationChannel: string;
  escalationProcedure: string;
  dataHandling: string;
}

export interface PentestCampaign {
  id: string;
  name: string;
  description: string;
  status: CampaignStatus;
  type: CampaignType;
  priority: CampaignPriority;
  startDate: string;
  endDate: string;
  clientName: string;
  clientContact?: string;
  scope: ScopeItem[];
  rulesOfEngagement?: RulesOfEngagement;
  team: TeamMember[];
  objectives: string[];
  methodology: string;
  findingsCount: {
    critical: number;
    high: number;
    medium: number;
    low: number;
    info: number;
  };
  progress: number; // 0-100
  tags: string[];
  createdAt: string;
  updatedAt: string;
  createdBy: string;
}

export interface Evidence {
  id: string;
  type: "image" | "video" | "file" | "code" | "request_response";
  name: string;
  url: string;
  mimeType?: string;
  size?: number;
  description?: string;
  createdAt: string;
}

export interface RequestResponse {
  id: string;
  method: string;
  url: string;
  requestHeaders: Record<string, string>;
  requestBody?: string;
  responseStatus: number;
  responseHeaders: Record<string, string>;
  responseBody?: string;
  notes?: string;
}

export interface Retest {
  id: string;
  testedBy: string;
  testedAt: string;
  result: "passed" | "failed" | "partial";
  notes: string;
  evidence: Evidence[];
}

export interface Comment {
  id: string;
  authorId: string;
  authorName: string;
  authorAvatar?: string;
  content: string;
  createdAt: string;
  updatedAt?: string;
}

export interface PentestFinding {
  id: string;
  campaignId: string;
  title: string;
  description: string;
  severity: FindingSeverity;
  status: FindingStatus;
  cvssScore?: number;
  cvssVector?: string;
  cweId?: string;
  cveId?: string;
  owaspCategory?: OwaspCategory;
  affectedAssets: string[];
  stepsToReproduce: string[];
  pocCode?: string;
  pocImages: Evidence[];
  pocVideos: Evidence[];
  requestResponses: RequestResponse[];
  businessImpact: string;
  technicalImpact: string;
  remediation: string;
  references: string[];
  assignedTo?: string;
  reviewedBy?: string;
  comments: Comment[];
  retests: Retest[];
  tags: string[];
  createdAt: string;
  updatedAt: string;
  createdBy: string;
}

// ============================================
// Helper Types
// ============================================

export type CampaignSummary = Pick<
  PentestCampaign,
  "id" | "name" | "status" | "type" | "priority" | "startDate" | "endDate" | "progress" | "findingsCount"
>;

export type FindingSummary = Pick<
  PentestFinding,
  "id" | "campaignId" | "title" | "severity" | "status" | "cvssScore" | "affectedAssets"
>;

// ============================================
// Report Types
// ============================================

export type ReportType =
  | "executive_summary"
  | "technical_report"
  | "finding_report"
  | "compliance_report"
  | "remediation_report"
  | "retest_report";

export type ReportFormat = "pdf" | "docx" | "xlsx" | "html" | "json";

export type ReportStatus = "draft" | "generating" | "completed" | "failed";

export const REPORT_TYPE_LABELS: Record<ReportType, string> = {
  executive_summary: "Executive Summary",
  technical_report: "Technical Report",
  finding_report: "Finding Report",
  compliance_report: "Compliance Report",
  remediation_report: "Remediation Report",
  retest_report: "Retest Report",
};

export const REPORT_TYPE_DESCRIPTIONS: Record<ReportType, string> = {
  executive_summary: "High-level overview for management and stakeholders",
  technical_report: "Detailed technical findings with PoC and remediation steps",
  finding_report: "Individual finding documentation with full details",
  compliance_report: "Findings mapped to compliance frameworks (OWASP, PCI-DSS)",
  remediation_report: "Prioritized remediation guidance with effort estimates",
  retest_report: "Verification results of remediated vulnerabilities",
};

export const REPORT_FORMAT_LABELS: Record<ReportFormat, string> = {
  pdf: "PDF Document",
  docx: "Word Document",
  xlsx: "Excel Spreadsheet",
  html: "HTML Report",
  json: "JSON Export",
};

export const REPORT_FORMAT_ICONS: Record<ReportFormat, string> = {
  pdf: "FileText",
  docx: "FileType",
  xlsx: "FileSpreadsheet",
  html: "Code",
  json: "Braces",
};

export interface ReportSection {
  id: string;
  title: string;
  enabled: boolean;
  order: number;
}

export interface ReportOptions {
  includeExecutiveSummary: boolean;
  includeFindings: boolean;
  includePoc: boolean;
  includeEvidence: boolean;
  includeRemediation: boolean;
  includeTimeline: boolean;
  includeAppendix: boolean;
  severityFilter: FindingSeverity[];
  statusFilter: FindingStatus[];
  customSections: ReportSection[];
  watermark?: string;
  classification?: "public" | "internal" | "confidential" | "restricted";
}

export interface PentestReport {
  id: string;
  campaignId: string;
  type: ReportType;
  format: ReportFormat;
  status: ReportStatus;
  name: string;
  description?: string;
  options: ReportOptions;
  generatedAt?: string;
  downloadUrl?: string;
  fileSize?: number;
  createdAt: string;
  createdBy: string;
  error?: string;
}

// ============================================
// Finding Template Types
// ============================================

export type TemplateCategory =
  | "injection"
  | "authentication"
  | "authorization"
  | "cryptographic"
  | "configuration"
  | "disclosure"
  | "session"
  | "input_validation"
  | "logic"
  | "other";

export const TEMPLATE_CATEGORY_LABELS: Record<TemplateCategory, string> = {
  injection: "Injection",
  authentication: "Authentication",
  authorization: "Authorization",
  cryptographic: "Cryptographic",
  configuration: "Configuration",
  disclosure: "Information Disclosure",
  session: "Session Management",
  input_validation: "Input Validation",
  logic: "Business Logic",
  other: "Other",
};

export const TEMPLATE_CATEGORY_ICONS: Record<TemplateCategory, string> = {
  injection: "Syringe",
  authentication: "Key",
  authorization: "Shield",
  cryptographic: "Lock",
  configuration: "Settings",
  disclosure: "Eye",
  session: "Clock",
  input_validation: "FormInput",
  logic: "GitBranch",
  other: "FileQuestion",
};

export interface FindingTemplate {
  id: string;
  name: string;
  category: TemplateCategory;
  severity: FindingSeverity;
  owaspCategory?: OwaspCategory;
  cweId?: string;
  description: string;
  stepsToReproduce: string[];
  businessImpact: string;
  technicalImpact: string;
  remediation: string;
  references: string[];
  tags: string[];
  isBuiltIn: boolean;
  createdAt: string;
  updatedAt: string;
  createdBy?: string;
  usageCount: number;
}

// Pre-defined OWASP templates data
export const BUILTIN_TEMPLATES: Partial<FindingTemplate>[] = [
  {
    name: "SQL Injection",
    category: "injection",
    severity: "critical",
    owaspCategory: "A03:2021",
    cweId: "CWE-89",
    description: "The application is vulnerable to SQL injection, allowing attackers to manipulate database queries. This can lead to unauthorized data access, data modification, or complete database compromise.",
    stepsToReproduce: [
      "Navigate to the vulnerable endpoint",
      "Insert SQL payload in the input field: ' OR '1'='1",
      "Observe the modified response indicating successful injection",
      "Use advanced payloads like UNION SELECT to extract data",
    ],
    businessImpact: "Complete compromise of database confidentiality, integrity, and availability. Potential data breach affecting customer information.",
    technicalImpact: "Unauthorized access to database, ability to read/modify/delete data, potential server compromise through advanced techniques.",
    remediation: "Use parameterized queries or prepared statements. Implement input validation and sanitization. Apply least privilege principle to database accounts.",
    references: [
      "https://owasp.org/www-community/attacks/SQL_Injection",
      "https://cheatsheetseries.owasp.org/cheatsheets/SQL_Injection_Prevention_Cheat_Sheet.html",
    ],
    tags: ["sqli", "injection", "database", "critical"],
    isBuiltIn: true,
  },
  {
    name: "Cross-Site Scripting (XSS) - Reflected",
    category: "injection",
    severity: "high",
    owaspCategory: "A03:2021",
    cweId: "CWE-79",
    description: "The application reflects user input without proper sanitization, allowing injection of malicious scripts that execute in victim browsers.",
    stepsToReproduce: [
      "Identify input fields or URL parameters reflected in the response",
      "Inject XSS payload: <script>alert('XSS')</script>",
      "Verify script execution in the browser",
      "Craft payload to steal session cookies or perform actions",
    ],
    businessImpact: "Session hijacking, credential theft, defacement, malware distribution, and phishing attacks against users.",
    technicalImpact: "Arbitrary JavaScript execution in user browsers, session token theft, DOM manipulation.",
    remediation: "Implement output encoding based on context. Use Content-Security-Policy headers. Validate and sanitize all user input.",
    references: [
      "https://owasp.org/www-community/attacks/xss/",
      "https://cheatsheetseries.owasp.org/cheatsheets/Cross_Site_Scripting_Prevention_Cheat_Sheet.html",
    ],
    tags: ["xss", "injection", "client-side"],
    isBuiltIn: true,
  },
  {
    name: "Broken Access Control - IDOR",
    category: "authorization",
    severity: "high",
    owaspCategory: "A01:2021",
    cweId: "CWE-639",
    description: "The application fails to verify user authorization when accessing resources by ID, allowing attackers to access other users' data by manipulating identifiers.",
    stepsToReproduce: [
      "Authenticate as a regular user",
      "Access a resource (e.g., /api/users/123/profile)",
      "Modify the ID parameter to another user's ID",
      "Observe unauthorized access to other user's data",
    ],
    businessImpact: "Unauthorized access to sensitive user data, privacy violations, potential regulatory compliance issues.",
    technicalImpact: "Horizontal privilege escalation, data leakage across user accounts.",
    remediation: "Implement proper access controls on all resources. Verify user ownership before allowing access. Use indirect references or UUIDs.",
    references: [
      "https://owasp.org/www-project-web-security-testing-guide/latest/4-Web_Application_Security_Testing/05-Authorization_Testing/04-Testing_for_Insecure_Direct_Object_References",
    ],
    tags: ["idor", "access-control", "authorization"],
    isBuiltIn: true,
  },
  {
    name: "Sensitive Data Exposure",
    category: "disclosure",
    severity: "high",
    owaspCategory: "A02:2021",
    cweId: "CWE-200",
    description: "The application exposes sensitive information such as credentials, API keys, or personal data through insecure storage, transmission, or error messages.",
    stepsToReproduce: [
      "Analyze application responses for sensitive data leakage",
      "Check error messages for detailed information",
      "Inspect network traffic for unencrypted sensitive data",
      "Review client-side code for hardcoded credentials",
    ],
    businessImpact: "Data breach, regulatory fines, reputation damage, potential identity theft for affected users.",
    technicalImpact: "Exposure of credentials, API keys, or personal data that can be used for further attacks.",
    remediation: "Encrypt sensitive data at rest and in transit. Implement proper error handling without detailed messages. Remove sensitive data from client-side code.",
    references: [
      "https://owasp.org/Top10/A02_2021-Cryptographic_Failures/",
    ],
    tags: ["data-exposure", "sensitive-data", "disclosure"],
    isBuiltIn: true,
  },
  {
    name: "Security Misconfiguration",
    category: "configuration",
    severity: "medium",
    owaspCategory: "A05:2021",
    cweId: "CWE-16",
    description: "The application or its underlying infrastructure has insecure default configurations, unnecessary features enabled, or missing security hardening.",
    stepsToReproduce: [
      "Scan the application for exposed admin interfaces",
      "Check for default credentials on services",
      "Identify unnecessary HTTP methods enabled",
      "Verify security headers are properly configured",
    ],
    businessImpact: "Increased attack surface, potential unauthorized access, information disclosure.",
    technicalImpact: "Exposed administrative functions, verbose error messages, missing security controls.",
    remediation: "Implement security hardening guidelines. Disable unnecessary features and services. Configure proper security headers. Regular security audits.",
    references: [
      "https://owasp.org/Top10/A05_2021-Security_Misconfiguration/",
    ],
    tags: ["misconfiguration", "hardening", "configuration"],
    isBuiltIn: true,
  },
  {
    name: "Broken Authentication",
    category: "authentication",
    severity: "critical",
    owaspCategory: "A07:2021",
    cweId: "CWE-287",
    description: "The application's authentication mechanism has weaknesses that allow attackers to compromise passwords, keys, or session tokens, or to exploit implementation flaws.",
    stepsToReproduce: [
      "Test for weak password policy enforcement",
      "Attempt brute force attacks on login",
      "Check for session fixation vulnerabilities",
      "Verify token generation randomness",
    ],
    businessImpact: "Account takeover, unauthorized access to user accounts, identity theft.",
    technicalImpact: "Session hijacking, credential compromise, authentication bypass.",
    remediation: "Implement strong password policies. Use multi-factor authentication. Implement account lockout mechanisms. Secure session management.",
    references: [
      "https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/",
    ],
    tags: ["authentication", "session", "credentials"],
    isBuiltIn: true,
  },
  {
    name: "Server-Side Request Forgery (SSRF)",
    category: "injection",
    severity: "high",
    owaspCategory: "A10:2021",
    cweId: "CWE-918",
    description: "The application fetches remote resources based on user-supplied URLs without proper validation, allowing attackers to access internal services or external resources.",
    stepsToReproduce: [
      "Identify functionality that fetches remote URLs",
      "Modify the URL parameter to internal addresses (e.g., http://localhost/admin)",
      "Test access to cloud metadata endpoints",
      "Attempt to scan internal network services",
    ],
    businessImpact: "Access to internal services, data exfiltration, cloud infrastructure compromise.",
    technicalImpact: "Internal network scanning, access to cloud metadata, bypass of network security controls.",
    remediation: "Validate and sanitize user-supplied URLs. Implement allowlists for permitted domains. Block requests to internal networks and metadata endpoints.",
    references: [
      "https://owasp.org/Top10/A10_2021-Server-Side_Request_Forgery_%28SSRF%29/",
    ],
    tags: ["ssrf", "server-side", "network"],
    isBuiltIn: true,
  },
  {
    name: "Insecure Deserialization",
    category: "input_validation",
    severity: "critical",
    owaspCategory: "A08:2021",
    cweId: "CWE-502",
    description: "The application deserializes untrusted data without proper validation, potentially allowing remote code execution or other attacks.",
    stepsToReproduce: [
      "Identify serialized data in requests/responses",
      "Analyze the serialization format used",
      "Craft malicious serialized payload",
      "Submit payload and observe execution",
    ],
    businessImpact: "Remote code execution, complete server compromise, data breach.",
    technicalImpact: "Arbitrary code execution, object injection, denial of service.",
    remediation: "Avoid deserializing untrusted data. Implement integrity checks on serialized objects. Use language-specific mitigations.",
    references: [
      "https://owasp.org/Top10/A08_2021-Software_and_Data_Integrity_Failures/",
    ],
    tags: ["deserialization", "rce", "critical"],
    isBuiltIn: true,
  },
];
