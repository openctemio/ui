"use client";

import { Badge } from "@/components/ui/badge";
import { cn } from "@/lib/utils";
import {
  Globe,
  Server,
  Layout,
  Smartphone,
  Code,
  Network,
  Users,
  Building,
  Cloud,
  Wifi,
} from "lucide-react";
import type {
  CampaignStatus,
  CampaignType,
  CampaignPriority,
  FindingSeverity,
  FindingStatus,
} from "../types";
import {
  CAMPAIGN_STATUS_LABELS,
  CAMPAIGN_STATUS_COLORS,
  CAMPAIGN_TYPE_LABELS,
  CAMPAIGN_PRIORITY_LABELS,
  CAMPAIGN_PRIORITY_COLORS,
  FINDING_SEVERITY_LABELS,
  FINDING_SEVERITY_COLORS,
  FINDING_STATUS_LABELS,
  FINDING_STATUS_COLORS,
} from "../types";

// ============================================
// Campaign Status Badge
// ============================================

interface CampaignStatusBadgeProps {
  status: CampaignStatus;
  className?: string;
}

export function CampaignStatusBadge({ status, className }: CampaignStatusBadgeProps) {
  const colors = CAMPAIGN_STATUS_COLORS[status];
  const label = CAMPAIGN_STATUS_LABELS[status];

  return (
    <Badge variant="outline" className={cn(colors.bg, colors.text, "border-0", className)}>
      {label}
    </Badge>
  );
}

// ============================================
// Campaign Type Badge
// ============================================

const TYPE_ICONS: Record<CampaignType, React.ElementType> = {
  external: Globe,
  internal: Server,
  web_app: Layout,
  mobile: Smartphone,
  api: Code,
  network: Network,
  social_engineering: Users,
  physical: Building,
  cloud: Cloud,
  wireless: Wifi,
};

interface CampaignTypeBadgeProps {
  type: CampaignType;
  showIcon?: boolean;
  className?: string;
}

export function CampaignTypeBadge({ type, showIcon = true, className }: CampaignTypeBadgeProps) {
  const Icon = TYPE_ICONS[type];
  const label = CAMPAIGN_TYPE_LABELS[type];

  return (
    <Badge variant="secondary" className={cn("gap-1.5", className)}>
      {showIcon && <Icon className="h-3 w-3" />}
      {label}
    </Badge>
  );
}

// ============================================
// Campaign Priority Badge
// ============================================

interface CampaignPriorityBadgeProps {
  priority: CampaignPriority;
  className?: string;
}

export function CampaignPriorityBadge({ priority, className }: CampaignPriorityBadgeProps) {
  const colors = CAMPAIGN_PRIORITY_COLORS[priority];
  const label = CAMPAIGN_PRIORITY_LABELS[priority];

  return (
    <Badge variant="outline" className={cn(colors.bg, colors.text, "border-0", className)}>
      {label}
    </Badge>
  );
}

// ============================================
// Finding Severity Badge
// ============================================

interface FindingSeverityBadgeProps {
  severity: FindingSeverity;
  className?: string;
}

export function FindingSeverityBadge({ severity, className }: FindingSeverityBadgeProps) {
  const colors = FINDING_SEVERITY_COLORS[severity];
  const label = FINDING_SEVERITY_LABELS[severity];

  return (
    <Badge variant="outline" className={cn(colors.bg, colors.text, "border-0", className)}>
      {label}
    </Badge>
  );
}

// ============================================
// Finding Status Badge
// ============================================

interface FindingStatusBadgeProps {
  status: FindingStatus;
  className?: string;
}

export function FindingStatusBadge({ status, className }: FindingStatusBadgeProps) {
  const colors = FINDING_STATUS_COLORS[status];
  const label = FINDING_STATUS_LABELS[status];

  return (
    <Badge variant="outline" className={cn(colors.bg, colors.text, "border-0", className)}>
      {label}
    </Badge>
  );
}

// ============================================
// Findings Count Badge (for campaign summary)
// ============================================

interface FindingsCountBadgeProps {
  counts: {
    critical: number;
    high: number;
    medium: number;
    low: number;
    info: number;
  };
  showZero?: boolean;
  className?: string;
}

export function FindingsCountBadge({ counts, showZero = false, className }: FindingsCountBadgeProps) {
  const items = [
    { severity: "critical" as const, count: counts.critical, color: "bg-red-500" },
    { severity: "high" as const, count: counts.high, color: "bg-orange-500" },
    { severity: "medium" as const, count: counts.medium, color: "bg-yellow-500" },
    { severity: "low" as const, count: counts.low, color: "bg-blue-500" },
    { severity: "info" as const, count: counts.info, color: "bg-gray-500" },
  ];

  const total = counts.critical + counts.high + counts.medium + counts.low + counts.info;

  if (total === 0 && !showZero) {
    return <span className="text-muted-foreground text-sm">No findings</span>;
  }

  return (
    <div className={cn("flex items-center gap-1", className)}>
      {items.map(
        ({ severity, count, color }) =>
          (count > 0 || showZero) && (
            <div
              key={severity}
              className={cn(
                "flex items-center justify-center min-w-[20px] h-5 px-1.5 rounded text-xs font-medium text-white",
                color
              )}
              title={`${FINDING_SEVERITY_LABELS[severity]}: ${count}`}
            >
              {count}
            </div>
          )
      )}
    </div>
  );
}

// ============================================
// Progress Badge
// ============================================

interface ProgressBadgeProps {
  progress: number;
  className?: string;
}

export function ProgressBadge({ progress, className }: ProgressBadgeProps) {
  const getColor = () => {
    if (progress >= 100) return "bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400";
    if (progress >= 75) return "bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400";
    if (progress >= 50) return "bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-400";
    if (progress >= 25) return "bg-orange-100 text-orange-700 dark:bg-orange-900/30 dark:text-orange-400";
    return "bg-gray-100 text-gray-700 dark:bg-gray-900/30 dark:text-gray-400";
  };

  return (
    <Badge variant="outline" className={cn(getColor(), "border-0", className)}>
      {progress}%
    </Badge>
  );
}
